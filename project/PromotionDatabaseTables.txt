Promotions table:

create table public.promotions (
  id uuid not null default gen_random_uuid (),
  title text not null,
  description text not null,
  start_date date not null,
  end_date date not null,
  products jsonb null default '[]'::jsonb,
  categories jsonb null default '[]'::jsonb,
  show_on_pwa boolean null default true,
  share_to_facebook boolean null default false,
  status text null default 'upcoming'::text,
  max_uses integer null,
  total_uses integer null default 0,
  created_by uuid null,
  created_at timestamp with time zone null default now(),
  updated_at timestamp with time zone null default now(),
  image_url text null,
  promotion_type text not null,
  total_views integer null default 0,
  total_clicks integer null default 0,
  updated_by uuid null,
  image_urls text[] null,
  layout_style character varying(50) null,
  text_alignment character varying(50) null,
  font_family character varying(100) null,
  font_size character varying(20) null,
  text_color character varying(20) null,
  button_text character varying(100) null,
  button_link text null,
  is_active boolean null default true,
  display_priority integer null default 0,
  display_settings jsonb null default '{"showAsModal": false, "modalTrigger": "immediate", "showAsBanner": false, "bannerPosition": "top", "showAsCarousel": false, "carouselInterval": 5000, "carouselPosition": "both", "showAsNotification": false, "notificationTrigger": "immediate"}'::jsonb,
  display_mode text null default 'banner'::text,
  constraint promotions_pkey primary key (id),
  constraint promotions_created_by_fkey foreign KEY (created_by) references auth.users (id) on delete set null,
  constraint promotions_updated_by_fkey foreign KEY (updated_by) references auth.users (id) on delete set null,
  constraint promotions_display_mode_check check (
    (
      display_mode = any (
        array[
          'banner'::text,
          'modal'::text,
          'notification'::text,
          'carousel'::text
        ]
      )
    )
  ),
  constraint promotions_promotion_type_check check (
    (
      promotion_type = any (
        array['new_item'::text, 'restock'::text, 'event'::text]
      )
    )
  ),
  constraint promotions_status_check check (
    (
      status = any (
        array[
          'draft'::text,
          'active'::text,
          'upcoming'::text,
          'expired'::text,
          'archived'::text
        ]
      )
    )
  ),
  constraint promotions_total_clicks_check check ((total_clicks >= 0)),
  constraint promotions_total_uses_check check ((total_uses >= 0)),
  constraint promotions_total_views_check check ((total_views >= 0)),
  constraint promotions_max_uses_check check (
    (
      (max_uses is null)
      or (max_uses > 0)
    )
  )
) TABLESPACE pg_default;

create index IF not exists idx_promotions_status on public.promotions using btree (status) TABLESPACE pg_default;

create index IF not exists idx_promotions_dates on public.promotions using btree (start_date, end_date) TABLESPACE pg_default;

create index IF not exists idx_promotions_pwa on public.promotions using btree (show_on_pwa) TABLESPACE pg_default
where
  (show_on_pwa = true);

create index IF not exists idx_promotions_facebook on public.promotions using btree (share_to_facebook) TABLESPACE pg_default
where
  (share_to_facebook = true);

create index IF not exists idx_promotions_created_by on public.promotions using btree (created_by) TABLESPACE pg_default;

create index IF not exists idx_promotions_promotion_type on public.promotions using btree (promotion_type) TABLESPACE pg_default;

create index IF not exists idx_promotions_total_views on public.promotions using btree (total_views) TABLESPACE pg_default;

create index IF not exists idx_promotions_total_clicks on public.promotions using btree (total_clicks) TABLESPACE pg_default;

create trigger update_promotion_status_trigger BEFORE INSERT
or
update on promotions for EACH row
execute FUNCTION update_promotion_status ();

create trigger update_promotions_updated_at BEFORE
update on promotions for EACH row
execute FUNCTION update_updated_at_column ();


create table public.branches (
  id uuid not null default gen_random_uuid (),
  name character varying(100) not null,
  code character varying(10) not null,
  address text not null,
  city character varying(50) not null,
  province character varying(50) not null,
  postal_code character varying(10) null,
  phone character varying(20) null,
  email character varying(255) null,
  manager_id uuid null,
  is_active boolean null default true,
  operating_hours jsonb null,
  created_at timestamp with time zone null default now(),
  branch_type character varying(20) null default 'satellite'::character varying,
  constraint branches_pkey primary key (id),
  constraint branches_manager_id_fkey foreign KEY (manager_id) references users (id),
  constraint branches_branch_type_check check (
    (
      (branch_type)::text = any (
        (
          array[
            'main'::character varying,
            'satellite'::character varying
          ]
        )::text[]
      )
    )
  )
) TABLESPACE pg_default;
